<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temporizador de Meditación</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-color: #ffffff;
            color: #024499;
        }
    </style>
</head>
<body class="flex flex-col items-center min-h-screen p-4">
    <!-- Logo de SacroVento -->
    <div class="text-center mb-6">
        <img src="LOGO SACROVENTO TRANSPARENTE.png" alt="Logo de SacroVento" class="w-32 h-auto mx-auto">
        <p class="text-lg font-bold" style="color: #dfa5c0;">MEDITACIÓN NO DUAL</p>
    </div>

    <!-- Configuración del temporizador -->
    <div class="text-center mb-6">
        <label for="meditation-time" class="block text-lg font-bold">Elige el tiempo por fase (en minutos):</label>
        <input id="meditation-time" type="number" min="1" max="120" value="15" class="border border-gray-300 rounded px-2 py-1 text-center w-24">
        <p class="mt-2">Cada meditación tendrá 4 fases de igual duración con 1 minuto de descanso entre ellas.</p>
    </div>

    <!-- Temporizador -->
    <div id="timer-container" class="text-center mb-6">
        <div id="timer-phase" class="text-2xl font-bold mb-2">Fase 1 de 4</div>
        <div id="timer" class="text-6xl font-mono mb-4" style="color: #024499;">15:00</div>
        <div class="flex justify-center gap-4">
            <button id="start" class="bg-pink-500 text-white px-4 py-2 rounded hover:bg-pink-600" style="background-color: #dfa5c0;">Iniciar</button>
            <button id="pause" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600" style="background-color: #024499;">Pausar</button>
            <button id="reset" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">Reiniciar</button>
        </div>
    </div>

    <!-- Registro de meditaciones -->
    <div class="w-full max-w-3xl mb-6">
        <h2 class="text-xl font-bold mb-4">Registro de Meditaciones</h2>
        <table class="table-auto w-full border-collapse border border-gray-300">
            <thead>
                <tr>
                    <th class="border border-gray-300 px-4 py-2">Fecha</th>
                    <th class="border border-gray-300 px-4 py-2">Hora</th>
                    <th class="border border-gray-300 px-4 py-2">Tiempo por fase</th>
                    <th class="border border-gray-300 px-4 py-2">Tiempo total</th>
                </tr>
            </thead>
            <tbody id="meditation-log">
                <!-- Los datos se añadirán aquí dinámicamente -->
            </tbody>
        </table>
        <button id="clear-history" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 mt-4">Borrar historial</button>
    </div>

    <!-- Espacio para escribir la experiencia -->
    <div class="w-full max-w-3xl mb-6">
        <h2 class="text-xl font-bold mb-4">Escribe sobre tu experiencia</h2>
        <textarea id="experience" rows="4" class="w-full border border-gray-300 rounded px-2 py-1" placeholder="Comparte cómo te sentiste durante la meditación..."></textarea>
    </div>

    <!-- Botón de impresión -->
    <div class="w-full max-w-3xl text-center">
        <h2 class="text-xl font-bold mb-4">Imprimir registro de meditaciones</h2>
        <label for="start-date" class="mr-2">Desde:</label>
        <input id="start-date" type="date" class="border border-gray-300 rounded px-2 py-1">
        <label for="end-date" class="ml-4 mr-2">Hasta:</label>
        <input id="end-date" type="date" class="border border-gray-300 rounded px-2 py-1">
        <button id="print" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 ml-4">Imprimir</button>
    </div>

    <!-- Sonidos -->
    <audio id="pause-reset-sound">
        <source src="Sonido pausa y reinicio.mp3" type="audio/mpeg">
    </audio>
    <audio id="end-phase-sound">
        <source src="Sonido de fin de 15 minutos.mp3" type="audio/mpeg">
    </audio>
    <audio id="end-rest-sound">
        <source src="Sonido de fin de los 2 minutos.mp3" type="audio/mpeg">
    </audio>

    <script>
        const meditationTimeInput = document.getElementById('meditation-time');
        const timerDisplay = document.getElementById('timer');
        const timerPhase = document.getElementById('timer-phase');
        const startButton = document.getElementById('start');
        const pauseButton = document.getElementById('pause');
        const resetButton = document.getElementById('reset');
        const meditationLog = document.getElementById('meditation-log');
        const experience = document.getElementById('experience');
        const pauseResetSound = document.getElementById('pause-reset-sound');
        const endPhaseSound = document.getElementById('end-phase-sound');
        const endRestSound = document.getElementById('end-rest-sound');
        const clearHistoryButton = document.getElementById('clear-history');
        const printButton = document.getElementById('print');
        const startDateInput = document.getElementById('start-date');
        const endDateInput = document.getElementById('end-date');

        let isRunning = false;
        let timerInterval;
        let meditationTime = 15 * 60; // Por defecto, 15 minutos en segundos
        let timeRemaining = meditationTime;
        let phase = 1;
        const totalPhases = 4;
        const restTime = 60; // 1 minuto de descanso en segundos
        let isMeditationPhase = true;

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        }

        function updateTimerDisplay() {
            timerDisplay.textContent = formatTime(timeRemaining);
        }

        function updatePhaseDisplay() {
            timerPhase.textContent = `Fase ${phase} de ${totalPhases}`;
        }

        function logMeditation() {
            const date = new Date();
            const formattedDate = date.toLocaleDateString();
            const formattedTime = date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            const totalTime = meditationTimeInput.value * totalPhases + 3; // Incluye los descansos
            meditationLog.innerHTML += `
                <tr>
                    <td class="border border-gray-300 px-4 py-2">${formattedDate}</td>
                    <td class="border border-gray-300 px-4 py-2">${formattedTime}</td>
                    <td class="border border-gray-300 px-4 py-2">${meditationTimeInput.value} minutos</td>
                    <td class="border border-gray-300 px-4 py-2">${totalTime} minutos</td>
                </tr>
            `;
        }

        function clearHistory() {
            meditationLog.innerHTML = '';
        }

        function printMeditationLog() {
            const startDate = new Date(startDateInput.value);
            const endDate = new Date(endDateInput.value);
            const logRows = Array.from(meditationLog.children);
            const filteredRows = logRows.filter(row => {
                const date = new Date(row.children[0].textContent);
                return date >= startDate && date <= endDate;
            });

            let printContent = `<table>
                <tr><th>Fecha</th><th>Hora</th><th>Tiempo por fase</th><th>Tiempo total</th></tr>
                ${filteredRows.map(row => row.outerHTML).join('')}
            </table>
            <h2>Anotaciones</h2>
            <p>${experience.value}</p>`;

            const printWindow = window.open('', '', 'width=800,height=600');
            printWindow.document.write(printContent);
            printWindow.document.close();
            printWindow.print();
        }

        meditationTimeInput.addEventListener('change', () => {
            meditationTime = parseInt(meditationTimeInput.value) * 60;
            resetTimer();
        });

        startButton.addEventListener('click', startTimer);
        pauseButton.addEventListener('click', pauseTimer);
        resetButton.addEventListener('click', resetTimer);
        clearHistoryButton.addEventListener('click', clearHistory);
        printButton.addEventListener('click', printMeditationLog);

        resetTimer(); // Inicializar
    </script>
</body>
</html>

